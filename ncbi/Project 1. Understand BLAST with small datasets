Project 1. Understand BLAST with small datasets
===============================================

Navigate to ``small_blast`` directory by::

	cd /home/ubuntu/ncbi-tutorial/data/small_blast

Task 1. Explore the data
------------------------

**What are in this folder?**

Let's see what we have in this folder::

	ls
	ls *	# List all subdirectories


- ``gene_db/``: a folder contains nucleotide sequence file ``single_gene.fa`` --- **database**

- ``metags/``: a folder contains metagenome file "small_meta.fa" --- **query**

- **Objective**: Compare and align sequences from ``small_meta.fa`` to ``single_gene.fa`` database


**How does sequence file look like?**

Let's look at the query file and the gene file::
	
	head metags/small_meta.fa
	head gene_db/single_gene.fa

**fasta**: One of the most common sequence file types. Fasta files may have extension as ``.fasta`` or ``.fna`` or ``.fa``

.. image:: fasta.png

Learn more about sequencing file format from `here
<https://www.ncbi.nlm.nih.gov/sra/docs/submitformats/#fastq-files>`_.


**How many sequences are there in the fasta file?**

we know that each sequence name will start with a special character, ``>``. So we can 

1. find lines that start with ``>``
2. count the total number of these lines 

Remember we can find specific characters in a file with ``grep``? For example, to find all instances of ``GGCG`` in the ``metags/small_meta.fa`` file, we could::

	grep "GGCG" metags/small_meta.fa

To find sequences, we know that each sequence will start with a special character, ``>``.

``^>`` matches line which starts with ``>``, the charter(s) after ``^``. So we are going to find this pattern with ``grep``, and pipe (``|``) these lines to the next command ``wc -l``::

	grep "^>" metags/small_meta.fa | wc -l


Task 2. Make database
---------------------
Making a database for genes is a smart way to index the gene sequences so that it can search and compare metagenome sequences (query) with gene sequences much faster.

To make a database of the single gene sequences:: 

    # Usage: makeblastdb -in <nifh-db> -dbtype nucl -out <nifh-db>
    
    cd /home/ubuntu/materials/ncbi-tutorial/data
    makeblastdb -in gene_db/single_gene.fa -dbtype nucl -out gene_db/single_gene.fa

    # the database looks like:
    ls gene_db/


Task 3. BLAST
-------------
Now we can BLAST the metagenome files to single gene database. I would suggest something like the following variables, note that the ``-outfmt 6`` flag identifies a tabular output::

    # Usage: blastn -query <metag file> -db <db file> -out <name of output> -outfmt 6
    
    cd /home/ubuntu/ncbi-tutorial/data
    
    blastn -query metags/small_meta.fa -db gene_db/single_gene.fa -out metags/small_meta.fa-blast-output.txt -outfmt 6


We can have a good understanding of ``-outfmt 6`` format from this `webpage
<https://sites.google.com/site/wiki4metagenomics/tools/blast/blastn-output-format-6>`_.


Exercise 1.1
------------

Navigate to the folder ``big_blast`` for Project 2 first, then list files and directories in this folder::
	cd /home/ubuntu/ncbi-tutorial/data/big_blast
	ls
	ls *	# List all subdirectories

**Exercise**:

1.1.1. Show the last 40 lines of ``nifh-ref.fa`` in ``nifh-db`` folder. (Hint: ``head`` command reads the file from the beginning and ``tail`` command reads the file from the ending)

1.1.2. Show the first 8 lines of ``corn.fa`` in ``metags`` folder

1.1.3. Get the total number of nitrogen fixation gene sequences in ``nifh-ref.fa`` file

1.1.4. Get the total number of sequences in the ``corn.fa`` file in ``metags`` folder

**Solution**:

1.1.1. Command::

	tail -40 nifh_db/nifh-ref.fa

1.1.2. Command::

	head -8 metags/corn.fa


1.1.3. There are 50 nifh gene seqeuces in ``nifh-db/nifh-ref.fa``. Command::

	grep "^>" nifh_db/nifh-ref.fa | wc -l

1.1.4. There are 8948 sequences in ``metags/corn.fa``. Command::

	grep "^>" metags/corn.fa | wc -l

